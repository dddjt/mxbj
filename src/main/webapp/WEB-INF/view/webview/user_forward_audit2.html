<!doctype html>
<html class="no-js">

	<head>
		<meta charset="UTF-8">

		<title>点豆成兵</title>

		<!--IE Compatibility modes-->
		<meta http-equiv="X-UA-Compatible" content="IE=edge">

		<!--Mobile first-->

		<!-- Bootstrap -->
		<link rel="stylesheet" href="../../css/webcss/bootstrap.min.css">

		<!-- Font Awesome -->
		<link rel="stylesheet" href="../../css/webcss/font-awesome.min.css">

		<!-- Metis core stylesheet -->
		<link rel="stylesheet" href="../../css/webcss/main.css">

		<!-- metisMenu stylesheet -->
		<link rel="stylesheet" href="../../css/webcss/metisMenu.min.css">
		
		<link rel="stylesheet" href="../../css/webcss/jquery-foxibox-0.2.css">

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

		<!--[if lt IE 9]>
      <script src="../../js/webjs/html5shiv.js"></script>
      <script src="../../js/webjs/respond.min.js"></script>
      <![endif]-->

		<link rel="stylesheet" href="../../css/webcss/theme.css">
		<link rel="stylesheet" href="../../css/webcss/jasny-bootstrap.min.css">
		<script src="../../js/webjs/less.min.js"></script>

		<!--Modernizr-->
		<script src="../../js/webjs/modernizr.min.js"></script>
		<script src="../../js/webjs/base.js"></script>
	</head>

	<body>
		<div class="bg-dark dk" id="wrap">
			<div id="top" class="bg-dark dk" style="width:100%;height:60px;position:fixed;top:0;left:0;z-index: 999999;">
				<header class="head">
					<div class="search-bar" style="text-align: center;">
						<img style="height:40px;width:103px;" src="../../img/webimg/logo_big.png">
					</div>
					<div class="main-bar" style="">
						<h3><i class="fa fa-legal"></i>&nbsp; 视频广告</h3>
					</div>
				</header>
			</div>

			<div id="left" class="bg-dark dker" style="width:250px;height:100%;position:fixed;top:60px;left:0;z-index: 999999;">
				<div class="media user-media bg-dark dker">
					<div class="user-media-toggleHover">
						<span class="fa fa-user"></span>
					</div>
					<div class="user-wrapper bg-dark">
						<a class="user-link" href="">
							<img class="media-object img-thumbnail user-img" style="width:64px;height:64px;" alt="User Picture" src="../../img/webimg/qrcode.jpg">
						</a>
						<div class="media-body">
							<h5 class="media-heading">欢迎登录点豆成兵</h5>
							<ul class="list-unstyled user-info">
								<li>Administrator</li>
								<li>最近一次访问 :
									<br>
									<small>
                    <i class="fa fa-calendar"></i>&nbsp;2015-12-31</small>
								</li>
							</ul>
						</div>
					</div>
				</div>

				<!-- #menu -->
				<ul id="menu" class="bg-blue dker">
					<li class="">
						<a href="admin_index.html">
							<i class="fa fa-upload"></i><span class="link-title">&nbsp;添加课程</span>
						</a>
					</li>
					<li class="">
						<a href="class_list.html">
							<i class="fa fa-book"></i><span class="link-title">&nbsp;课程列表</span>
						</a>
					</li>
					<li class="">
						<a href="open_class_banner.html">
							<i class="fa fa-align-justify"></i><span class="link-title">&nbsp;公开课Banner</span>
						</a>
					</li>
					<li class="">
						<a href="live_class_share.html">
							<i class="fa fa-share-alt"></i><span class="link-title">&nbsp;直播课程分享链接</span>
						</a>
					</li>
					<li class="">
						<a href="user_question_list.html">
							<i class="fa fa-question-circle"></i><span class="link-title">&nbsp;直播课程提问</span>
						</a>
					</li>
					<li class="">
						<a href="live_class_apply.html">
							<i class="fa fa-github-alt"></i><span class="link-title">&nbsp;直播课程报名人数统计</span>
						</a>
					</li>
					<li class="">
						<a href="open_class_study_count.html">
							<i class="fa fa fa-beer"></i><span class="link-title">&nbsp;公开课学习人数统计</span>
						</a>
					</li>
					<li class="nav-divider"></li>
					<li class="">
						<a href="user_forward_audit.html">
							<i class="fa fa-legal"></i><span class="link-title">&nbsp;视频广告</span>
						</a>
					</li>
					<li class="nav-divider"></li>
					<li class="">
						<a href="weixin_user_list.html">
							<i class="fa fa-user"></i><span class="link-title">&nbsp;微信用户列表</span>
						</a>
					</li>
					<li class="nav-divider"></li>
					<li class="">
						<a href="live_class_statistic.html">
							<i class="fa fa-align-left"></i><span class="link-title">&nbsp;直播课程统计信息</span>
						</a>
					</li>
					<li class="nav-divider"></li>
					<li>
						<a href="/web/webUserLogout">
							<i class="fa fa-sign-out"></i>
							<span class="link-title">退出</span>
						</a>
					</li>
				</ul>
				<!-- /#menu -->
			</div>
			<!-- /#left -->
			<div id="content" style="margin-left:250px;margin-top:60px;">
				<div class="outer">
					<div class="inner bg-light lter" style="overflow-y: auto;">
						<div class="row">
			              <div class="col-lg-12">
			                <div class="box">
			                  <header>
			                    <div class="icons">
			                      <i class="fa fa-table"></i>
			                    </div>
			                    <h5>用户分享朋友圈截图审核</h5>
			                    <!-- .toolbar -->
											<div class="toolbar">
												<nav style="padding: 2px;">
													<a href="javascript:auditUser(1);" class="btn btn-danger">
														审核拒绝
													</a>
													<a href="javascript:auditUser(0);" class="btn btn-success">
														审核通过
													</a>
												</nav>
											</div>
											<!-- /.toolbar -->
			                  </header>
			                  <div id="collapse4" class="body">
			                    <table id="dataTable" style="white-space:normal;" class="table table-bordered table-condensed table-hover table-striped">
			                      <thead>
			                        <tr>
			                          <th nowrap="nowrap" style="width:20px;"><input onclick="selectAll();" id="select_all" type="checkbox"></th>
			                          <th nowrap="nowrap">用户ID</th>
			                          <th nowrap="nowrap">所选课程ID</th>
			                          <th nowrap="nowrap">上传时间</th>
			                          <th nowrap="nowrap">审核状态</th>
			                          <th nowrap="nowrap">分享截图</th>
			                        </tr>
			                      </thead>
			                      <tbody id="data_detail">
			                        
			                      </tbody>
			                    </table>
			                  </div>
			                </div>
			              </div>
			            </div><!-- /.row -->
					</div>
					<!-- /.inner -->
				</div>
				<!-- /.outer -->
			</div>
			<!-- /#content -->
		</div>
		<!-- /#wrap -->
		<div id="helpModal" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title">消息提示</h4>
					</div>
					<div class="modal-body" id="tips_info">
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<footer class="Footer bg-dark dker" style="width:100%;height:48px;position:fixed;bottom:0;left:0;z-index: 999999;">
			<p>沪ICP备15002235号-4 | COPYRIGHT &copy; 2014-2015, BANGRONGNETWORKTECH, ALL RIGHTS RESERVED</p>

		</footer>
		<!-- /#footer -->

		<!--jQuery -->
		<script src="../../js/webjs/jquery.min.js"></script>
		<script src="../../js/webjs/jquery-foxibox-0.2.min.js"></script>

		<!--Bootstrap -->
		<script src="../../js/webjs/bootstrap.min.js"></script>

		<!-- MetisMenu -->
		<script src="../../js/webjs/metisMenu.min.js"></script>

		<!-- Screenfull -->
		<script src="../../js/webjs/screenfull.min.js"></script>

		<script src="../../js/webjs/jasny-bootstrap.min.js"></script>

		<!-- Metis core scripts -->
		<script src="../../js/webjs/core.min.js"></script>

		<!-- Metis demo scripts -->
		<script src="../../js/webjs/app.js"></script>
		<script>
			$('.outer').height($('#left').height() - 48 - 61 - 19);
			$('.inner').height($('#left').height() - 48 - 61 - 20 - 20);
			$(window).resize(function() {
				$('.outer').height($('#left').height() - 48 - 61 - 19);
				$('.inner').height($('#left').height() - 48 - 61 - 20 - 20);
			});
			function checkJsonIsEmpty(json) {
				var isEmpty = true;
				if (json == null) return true;
				for (var jsonKey in json) {
					isEmpty = false;
					break;
				}
				return isEmpty;
			}
			function createDataList(data) {
				var detailNode = document.getElementById('data_detail');
				detailNode.innerHTML = "";
				for (var i in data) {
					var thNode = document.createElement('tr');
					thNode.innerHTML = "<td><input user_id='"+data[i].user_id+"' course_id='"+data[i].course_id+"' class='audit_user' type='checkbox'></td><td nowrap='nowrap'>"+data[i].user_id+"</td><td>"+data[i].course_id+"</td><td nowrap='nowrap'>"+data[i].upload_time+"</td><td nowrap='nowrap'>"+(data[i].forward_status == "0" ? "未审核" : (data[i].forward_status == "1" ? "审核通过" : "审核未通过"))+"</td><td><a href='/files/forwardimage/"+data[i].screenshot+"' data-lightbox='image-"+data[i].user_id+data[i].course_id+"'>"+data[i].screenshot+"</a></td>";
					detailNode.appendChild(thNode);
				}
			}
			function selectAll() {
				$(".audit_user").each(function(){
					this.checked = $('#select_all').is(':checked');
				})
			}
			function auditUser(auditStatus) {
				var selectedInputs = $('input:checkbox[class=audit_user]:checked');
				if(selectedInputs.length == 0) {
					$('#tips_info').html("<p>您还没有选择需要审核的用户数据，请先选择！</p>");
					$('#helpModal').modal("show");
				} else {
					var data = ""
					selectedInputs.each(function(){
						if(data == "") {
							data = $(this).attr("user_id") + "_" + $(this).attr("course_id");
						} else {
							data = ";" + $(this).attr("user_id") + "_" + $(this).attr("course_id");
						}
					});
					$.ajax({
						url: '/course/auditUserCourse',
						type: "POST",
						data: {
							list : data,
							auditStatus : auditStatus
						},
						success: function(data) {
							if(data.error_code == "0") {
								$.ajax({
									url: '/course/getUserCourse',
									type: "POST",
									data: {},
									success: function(data) {
										if (!checkJsonIsEmpty(data)) {
											createDataList(data);
										}
									},
									error: function(status, error) {
									}
								});
							} else {
								$('#tips_info').html("<p>"+data.error_msg+"</p>");
								$('#helpModal').modal("show");
							}
						},
						error: function(status, error) {
							$('#tips_info').html("<p>服务器暂时无法处理您的请求，请稍后重试或联系系统管理员！</p>");
							$('#helpModal').modal("show");
						}
					});
				}
			}
			$.ajax({
				url: '/course/getUserCourse',
				type: "POST",
				data: {},
				success: function(data) {
					if (!checkJsonIsEmpty(data)) {
						createDataList(data);
					}
				},
				error: function(status, error) {
				}
			});
		</script>
	</body>