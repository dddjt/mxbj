<!doctype html>
<html class="no-js">

	<head>
		<meta charset="UTF-8">

		<title>点豆成兵</title>

		<!--IE Compatibility modes-->
		<meta http-equiv="X-UA-Compatible" content="IE=edge">

		<!--Mobile first-->

		<!-- Bootstrap -->
		<link rel="stylesheet" href="/css/webcss/bootstrap.min.css">

		<!-- Font Awesome -->
		<link rel="stylesheet" href="/css/webcss/font-awesome.min.css">

		<!-- Metis core stylesheet -->
		<link rel="stylesheet" href="/css/webcss/main.css">

		<!-- metisMenu stylesheet -->
		<link rel="stylesheet" href="/css/webcss/metisMenu.min.css">

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->

		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

		<!--[if lt IE 9]>
      <script src="/js/webjs/html5shiv.js"></script>
      <script src="/js/webjs/respond.min.js"></script>
      <![endif]-->

		<link rel="stylesheet" href="/css/webcss/theme.css">
		<link rel="stylesheet" href="/css/webcss/jasny-bootstrap.min.css">
		<link rel="stylesheet" href="/css/webcss/bootstrap-datetimepicker.min.css">
		<link rel="stylesheet" href="/css/webcss/datepicker3.min.css">
		<link rel="stylesheet" href="/css/webcss/jasny-bootstrap.min.css">
		<script src="/js/webjs/less.min.js"></script>

		<!--Modernizr-->
		<script src="/js/webjs/modernizr.min.js"></script>
		<script src="/js/webjs/base.js"></script>
	</head>

	<body>
		<div class="bg-dark dk" id="wrap">
			<div id="top" class="bg-dark dk" style="width:100%;height:60px;position:fixed;top:0;left:0;z-index: 999999;">
				<header class="head">
					<div class="search-bar" style="text-align: center;">
						<img style="height:40px;width:103px;" src="/img/webimg/logo_big.png">
					</div>
					<div class="main-bar" style="">
						<h3><i class="fa fa-upload"></i>&nbsp; 添加课程</h3>
					</div>
				</header>
			</div>

			<div id="left" class="bg-dark dker" style="width:250px;height:100%;position:fixed;top:60px;left:0;z-index: 999999;">
				<div class="media user-media bg-dark dker">
					<div class="user-media-toggleHover">
						<span class="fa fa-user"></span>
					</div>
					<div class="user-wrapper bg-dark">
						<a class="user-link" href="">
							<img class="media-object img-thumbnail user-img" style="width:64px;height:64px;" alt="User Picture" src="/img/webimg/qrcode.jpg">
						</a>
						<div class="media-body">
							<h5 class="media-heading">欢迎登录点豆成兵</h5>
							<ul class="list-unstyled user-info">
								<li>Administrator</li>
							</ul>
						</div>
					</div>
				</div>

				<!-- #menu -->
				<ul id="menu" class="bg-blue dker">
					<li class="nav-divider"></li>
					<li class="">
						<a href="admin_index.html">
							<i class="fa fa-upload"></i><span class="link-title">&nbsp;添加课程</span>
						</a>
					</li>
					<li class="">
						<a href="class_list.html">
							<i class="fa fa-book"></i><span class="link-title">&nbsp;课程列表</span>
						</a>
					</li>
					<li class="">
						<a href="open_class_banner.html">
							<i class="fa fa-align-justify"></i><span class="link-title">&nbsp;公开课Banner</span>
						</a>
					</li>
					<li class="nav-divider"></li>
					<li class="">
						<a href="user_forward_audit.html">
							<i class="fa fa-legal"></i><span class="link-title">&nbsp;用户分享审核</span>
						</a>
					</li>
					<li class="nav-divider"></li>
					<li>
						<a href="/web/webUserLogout">
							<i class="fa fa-sign-out"></i>
							<span class="link-title">退出</span>
						</a>
					</li>
				</ul>
				<!-- /#menu -->
			</div>
			<!-- /#left -->
			<div id="content" style="margin-left:250px;margin-top:60px;">
				<div class="outer">
					<div class="inner bg-light lter" style="overflow-y: auto;">
						<div class="col-lg-12">
							<div class="row">
								<div class="col-lg-6">
									<div class="box dark">
										<header>
											<div class="icons">
												<i class="fa fa-edit"></i>
											</div>
											<h5>编辑课程信息</h5>

											<!-- .toolbar -->
											<div class="toolbar">
												<nav style="padding: 8px;">
													<a href="javascript:;" class="btn btn-default btn-xs collapse-box">
														<i class="fa fa-minus"></i>
													</a>
													<a href="javascript:;" class="btn btn-default btn-xs full-box">
														<i class="fa fa-expand"></i>
													</a>
												</nav>
											</div>
											<!-- /.toolbar -->
										</header>
										<div id="div-1" class="body" style="height:500px;">
											<form class="form-horizontal">
												<div class="form-group">
													<label for="course_name" class="control-label col-lg-4">课程名称</label>
													<div class="col-lg-8">
														<input type="text" id="name" placeholder="" class="form-control">
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="course_abstract" class="control-label col-lg-4">课程摘要</label>
													<div class="col-lg-8">
														<textarea id="course_abstract" class="form-control"></textarea>
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="teacher_abstract" class="control-label col-lg-4">导师摘要</label>
													<div class="col-lg-8">
														<input type="text" id="teacher" placeholder="" class="form-control">
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="teacher_name" class="control-label col-lg-4">导师姓名</label>
													<div class="col-lg-8">
														<input type="text" id="teacher_name" placeholder="" class="form-control">
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="teacher_position" class="control-label col-lg-4">导师职位</label>
													<div class="col-lg-8">
														<input type="text" id="teacher_position" placeholder="" class="form-control">
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="teacher_info" class="control-label col-lg-4">导师详情</label>
													<div class="col-lg-8">
														<textarea id="teacher_info" class="form-control"></textarea>
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="crowd" class="control-label col-lg-4">适用人群</label>
													<div class="col-lg-8">
														<textarea id="crowd" class="form-control"></textarea>
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="details" class="control-label col-lg-4">课程详情</label>
													<div class="col-lg-8">
														<textarea id="details" class="form-control"></textarea>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-lg-4" for="dpYears">开课日期</label>
													<div class="col-lg-8">
														<div class="input-group date" id="dpYears" data-date="" >
															<input class="form-control" type="text" id="course_date" value="" readonly>
															<span class="input-group-addon add-on"><i class="fa fa-calendar"></i></span>
														</div>
													</div>
												</div>
												<!-- /.form-group -->
												<div class="form-group">
													<label for="course_length" class="control-label col-lg-4">课程时常(单位：分钟)</label>
													<div class="col-lg-8">
														<input type="text" id="course_length" placeholder="" class="form-control">
													</div>
												</div>
												 <div class="form-group">
							                        <label class="control-label col-lg-4">课程类型</label>
							                        <div class="col-lg-8">
							                          <select id="course_type" class="form-control">
							                            <option value='0'>公开课</option>
							                            <option value='1'>非公开课</option>
							                          </select>
							                        </div>
							                      </div>
												<!-- <div class="form-group">
													<label class="control-label col-lg-4">开课时间</label>
													<div class="col-lg-8">
														<div class='input-group date' id='datetimepicker4'>
															<input type='text' class="form-control" id="course_time" readonly/>
															<span class="input-group-addon"><span class="glyphicon glyphicon-time"></span>
															</span>
														</div>
													</div>
												</div> -->
											</form>
										</div>
									</div>
								</div>

								<!--END TEXT INPUT FIELD-->

								<!--BEGIN SELECT        -->
								<div class="col-lg-6">
									<div class="box dark">
										<header>
											<div class="icons">
												<i class="fa fa-th-large"></i>
											</div>
											<h5>图片视频选择</h5>

											<!-- .toolbar -->
											<div class="toolbar">
												<nav style="padding: 8px;">
													<a href="javascript:;" class="btn btn-default btn-xs collapse-box">
														<i class="fa fa-minus"></i>
													</a>
													<a href="javascript:;" class="btn btn-default btn-xs full-box">
														<i class="fa fa-expand"></i>
													</a>
												</nav>
											</div>
											<!-- /.toolbar -->
										</header>
										<div id="div-2" class="body" style="height:500px;">
											<form class="form-horizontal">
												<div class="form-group">
													<label class="control-label col-lg-4">课程图片</label>
													<div class="col-lg-8">
														<div class="fileinput fileinput-new" data-provides="fileinput">
															<div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 200px; height: 150px;"></div>
															<div>
																<span class="btn btn-default btn-file"><span class="fileinput-new">选择图片</span> <span class="fileinput-exists">重新选择</span>
																<input type="file" name="course_img" id="course_img">
																</span>
																<a href="#" class="btn btn-default fileinput-exists" data-dismiss="fileinput">删除图片</a>
															</div>
														</div>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-lg-4">导师头像</label>
													<div class="col-lg-8">
														<div class="fileinput fileinput-new" data-provides="fileinput">
															<div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 200px; height: 150px;"></div>
															<div>
																<span class="btn btn-default btn-file"><span class="fileinput-new">选择图片</span> <span class="fileinput-exists">重新选择</span>
																<input type="file" name="teacher_img" id="teacher_img">
																</span>
																<a href="#" class="btn btn-default fileinput-exists" data-dismiss="fileinput">删除图片</a>
															</div>
														</div>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-lg-4">视频封面图片</label>
													<div class="col-lg-8">
														<div class="fileinput fileinput-new" data-provides="fileinput">
															<div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 200px; height: 150px;"></div>
															<div>
																<span class="btn btn-default btn-file"><span class="fileinput-new">选择图片</span> <span class="fileinput-exists">重新选择</span>
																<input type="file" name="video_img" id="video_img">
																</span>
																<a href="#" class="btn btn-default fileinput-exists" data-dismiss="fileinput">删除图片</a>
															</div>
														</div>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-lg-4">课程视频</label>
													<div class="col-lg-8">
														<div class="fileinput fileinput-new" data-provides="fileinput">
															<div class="input-group">
																<div class="form-control uneditable-input span3" data-trigger="fileinput">
																	<i class="glyphicon glyphicon-file fileinput-exists"></i> <span class="fileinput-filename"></span> </div>
																<span class="input-group-addon btn btn-default btn-file"><span class="fileinput-new">选择文件</span> <span class="fileinput-exists">重新选择</span>
																<input type="file" name="video_src" id="video_src">
																</span>
																<a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">删除文件</a>
															</div>
														</div>
													</div>
												</div>
											</form>
										</div>
									</div>
									<div id="progress_tip" class="progress progress-striped active" style="display:none;">
										<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" data-original-title="" title="" aria-describedby="popover352425">
											<span class="sr-only">40% Complete (success)</span>
										</div>
									</div>
									<div>
										<a id="submit_course" href="javascript:void(0);" class="btn btn-success btn-lg btn-grad pull-right">提交课程</a>
									</div>
								</div>

								<!--END SELECT-->
							</div>
						</div>
					</div>
					<!-- /.inner -->
				</div>
				<!-- /.outer -->
			</div>
			<!-- /#content -->
		</div>
		<!-- /#wrap -->
		<div id="helpModal" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title">消息提示</h4>
					</div>
					<div class="modal-body" id="tips_info">
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>

		<footer class="Footer bg-dark dker" style="width:100%;height:48px;position:fixed;bottom:0;left:0;z-index: 999999;">
			<p>沪ICP备15002235号-4 | COPYRIGHT &copy; 2014-2015, BANGRONGNETWORKTECH, ALL RIGHTS RESERVED</p>

		</footer>
		<!-- /#footer -->

		<!--jQuery -->
		<script src="/js/webjs/jquery.min.js"></script>

		<!--Bootstrap -->
		<script src="/js/webjs/bootstrap.min.js"></script>

		<!-- MetisMenu -->
		<script src="/js/webjs/metisMenu.min.js"></script>

		<!-- Screenfull -->
		<script src="/js/webjs/screenfull.min.js"></script>

		<script src="/js/webjs/jasny-bootstrap.min.js"></script>
		<script src="/js/webjs/moment.min.js"></script>
		<script src="/js/webjs/bootstrap-datetimepicker.min.js"></script>
		<script src="/js/webjs/bootstrap-datepicker.min.js"></script>
		<!-- Metis core scripts -->
		<script src="/js/webjs/core.min.js"></script>

		<!-- Metis demo scripts -->
		<script src="/js/webjs/app.js"></script>
		<script>
			$('.outer').height($('#left').height() - 48 - 61 - 19);
			$('.inner').height($('#left').height() - 48 - 61 - 20 - 20);
			$(window).resize(function() {
				$('.outer').height($('#left').height() - 48 - 61 - 19);
				$('.inner').height($('#left').height() - 48 - 61 - 20 - 20);
			});
			$(function() {
				$('#dpYears').datetimepicker({
					startDate: new Date(),
					format: 'YYYY-MM-DD HH:mm'
				});
				/* $('#datetimepicker4').datetimepicker({
					format: 'HH:mm',
					pickDate: false
				}); */
			});
			function checkInput() {
				var name = $('#name').val();
				var course_abstract = $('#course_abstract').val();
				var teacher = $('#teacher').val();
				var teacher_name = $('#teacher_name').val();
				var teacher_position = $('#teacher_position').val();
				var teacher_info = $('#teacher_info').val();
				var crowd = $('#crowd').val();
				var details = $('#details').val();
				var course_date = $('#course_date').val()+":00";
				var course_length = $('#course_length').val();
				var course_img = $('#course_img').val();
				var teacher_img = $('#teacher_img').val();
				var course_type = $('#course_type').val();
				var video_img = $('#video_img').val();
				var video_src = $('#video_src').val();
				if(name == null || name == "" ||
					course_abstract == null || course_abstract == "" ||
					teacher == null || teacher == "" ||
					teacher_name == null || teacher_name == "" ||
					teacher_position == null || teacher_position == "" ||
					teacher_info == null || teacher_info == "" ||
					crowd == null || crowd == "" ||
					details == null || details == "" ||
					course_date == null || course_date == "" ||
					course_img == null || course_img == "" ||
					course_length == null || course_length == "" ||
					teacher_img == null || teacher_img == "" ||
					video_img == null || video_img == "" ||
					video_src == null || video_src == "") {
					$('#tips_info').html("<p>所有选项全部需要填写，您当前还有未填写的，请检查！</p>");
					$('#helpModal').modal("show");
					return null;
				} else {
					var data = {
						name:name,
						course_abstract:course_abstract,
						teacher:teacher,
						teacher_name:teacher_name,
						teacher_position:teacher_position,
						teacher_info:teacher_info,
						crowd:crowd,
						details:details,
						course_date:course_date,
						course_length:course_length,
						course_type:course_type
					};
					return data;
				}
			}
			$('#submit_course').click(function() {
				/* $('#helpModal').modal();
				$('.progress.progress-striped').show(); */
				var data = checkInput();
				if(data != null) {
					$("#submit_course").attr('disabled', "");
					$("#progress_tip").show();
					var formData = data;
					var xhr = new XMLHttpRequest();
					var fd = new FormData();
					for (var jsonKey in formData) {
						fd.append(jsonKey, formData[jsonKey]);
					}
					/* var fileIndex = 0;
					for (var key in data.files) {
						fd.append("file" + fileIndex, data.files[key]);
						fileIndex++;
					} */
					fd.append("files", document.getElementById("course_img").files[0]);
					fd.append("files", document.getElementById("teacher_img").files[0]);
					fd.append("files", document.getElementById("video_img").files[0]);
					fd.append("files", document.getElementById("video_src").files[0]);
					xhr.upload.addEventListener("progress", function(evt) {
						if (evt.lengthComputable) {
							var percentComplete = Math.round(evt.loaded * 100 / evt.total);
							var percent = percentComplete + "%";
							$('.progress-bar.progress-bar-success').css("width", percent);
						}
					}, false);
					xhr.addEventListener("load", function(evt) {
						$("#submit_course").removeAttr('disabled');
						var res = JSON.parse(evt.target.responseText);
						if (res.error_code == '0') {
							$('#tips_info').html("<p>提交课程信息成功！</p>");
							$('#helpModal').modal();
							$('#name').val("");
							$('#course_abstract').val("");
							$('#teacher').val("");
							$('#teacher_name').val("");
							$('#teacher_position').val("");
							$('#teacher_info').val("");
							$('#crowd').val("");
							$('#details').val("");
							$('#course_date').val("");
							$('#course_img').val("");
							$('#teacher_img').val("");
							$('#video_img').val("");
							$('#video_src').val("");
							$('#course_length').val("");
							$(".btn.btn-default.fileinput-exists").each(function(){
								this.click();
							});
							$('.progress-bar.progress-bar-success').css("width", "0%");
						} else {
							$('#tips_info').html("<p>提交课程失败，请联系系统管理员！</p>");
							$('#helpModal').modal();
							$('.progress-bar.progress-bar-success').css("width", "0%");
						}
						$("#progress_tip").hide();
					}, false);
					xhr.addEventListener("error", function(evt) {
						$("#progress_tip").hide();
						$("#submit_course").removeAttr('disabled');
						$('#tips_info').html("<p>提交课程失败，请联系系统管理员！</p>");
						$('#helpModal').modal();
						$('.progress-bar.progress-bar-success').css("width", "0%");
					}, false);
					xhr.addEventListener("abort", null, false);
					xhr.open("POST", "/course/addCourse");
					xhr.send(fd);
				}
			})
		</script>
	</body>